<script type="text/ng-template" id="promethee/text">
  <div ng-controller="TextController">
    <div  dnd-draggable="component"
          dnd-moved="remove()"
          dnd-type="component.type"
          class="promethee-editor__component promethee-editor__component--text promethee-editor__component--final">

      <div class="promethee-editor__toolbar">
        Text
        <span ng-click="remove()" class="promethee-editor__button pull-right"><%= fa_icon :close %></span>
      </div>

      <div ng-show="editing">
        <textarea ui-tinymce="tinymceOptions" ng-model="component.attributes.body"></textarea>
      </div>
      <div ng-hide="editing">
        <div class="promethee-editor__wrapper" ng-bind-html="component.attributes.body | htmlSafe" ng-click="edit()"></div>
      </div>
    </div>
  </div>
</script>

<script>
  angular.injector(['ng', '<%= promethee_id %>']).get('definitions').push({
    name: 'Text',
    thumb: 'http://via.placeholder.com/300x200',
    data: {
      type: 'text',
      attributes: {
        body: 'Edit me'
      }
    }
  });

  promethee.controller('TextController', ['$scope', function($scope) {

    $scope.editing = false;

    $scope.edit = function() {
      this.editing = true;
    };

    $scope.complete = function() {
      this.editing = false;
    };

    $scope.remove = function() {
      this.components.splice(this.components.indexOf(this.component), 1);
    };

    $scope.tinymceOptions = {
      plugins: 'autoresize',
      toolbar: 'styleselect | bold italic',
      menubar: false,
      statusbar: false,
      branding: false,
      autoresize_bottom_margin: 0
    };

  }]);
</script>
